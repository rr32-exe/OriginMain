---
// Comparison Table Component
// Props: products (array), articleId
const { products, articleId = null } = Astro.props;

if (!products || products.length === 0) {
  return null;
}
---

<div class="comparison-table-wrapper overflow-x-auto my-8">
  <table class="comparison-table w-full border-collapse bg-white shadow-lg rounded-lg overflow-hidden">
    <thead class="bg-primary text-white">
      <tr>
        <th class="p-4 text-left font-semibold">Product</th>
        <th class="p-4 text-center font-semibold">Price</th>
        <th class="p-4 text-center font-semibold">Commission</th>
        <th class="p-4 text-center font-semibold">Rating</th>
        <th class="p-4 text-center font-semibold">Action</th>
      </tr>
    </thead>
    <tbody>
      {products.map((product, index) => {
        const affiliateLink = articleId 
          ? `/go/${product.id}?article=${articleId}`
          : `/go/${product.id}`;
        
        const bgClass = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
        
        return (
          <tr class={`${bgClass} hover:bg-gray-100 transition-colors`}>
            {/* Product Info */}
            <td class="p-4">
              <div class="flex items-center gap-3">
                <img 
                  src={product.image_url || '/images/placeholder-product.jpg'} 
                  alt={product.title}
                  class="w-16 h-16 object-cover rounded"
                  loading="lazy"
                />
                <div>
                  <div class="font-semibold text-gray-900">{product.title}</div>
                  {product.category && (
                    <div class="text-xs text-gray-500 mt-1">{product.category}</div>
                  )}
                </div>
              </div>
            </td>

            {/* Price */}
            <td class="p-4 text-center">
              <div class="text-xl font-bold text-primary">
                ${product.price.toFixed(2)}
              </div>
            </td>

            {/* Commission */}
            <td class="p-4 text-center">
              <div class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                {product.commission_rate}%
              </div>
            </td>

            {/* Rating (placeholder - could be calculated from reviews) */}
            <td class="p-4 text-center">
              <div class="flex justify-center items-center gap-1">
                {[...Array(5)].map((_, i) => (
                  <svg 
                    key={i}
                    class={`w-5 h-5 ${i < 4 ? 'text-yellow-400' : 'text-gray-300'}`}
                    fill="currentColor" 
                    viewBox="0 0 20 20"
                  >
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                ))}
              </div>
              <div class="text-xs text-gray-500 mt-1">4.0/5</div>
            </td>

            {/* Action Button */}
            <td class="p-4 text-center">
              <a 
                href={affiliateLink}
                data-product-id={product.id}
                data-article-id={articleId}
                class="inline-flex items-center px-4 py-2 bg-secondary hover:bg-accent text-white font-semibold rounded-lg transition-colors duration-200"
                target="_blank"
                rel="noopener noreferrer"
              >
                View Deal
                <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                </svg>
              </a>
            </td>
          </tr>
        );
      })}
    </tbody>
  </table>
</div>

{/* Mobile-responsive note */}
<style>
  .comparison-table-wrapper {
    -webkit-overflow-scrolling: touch;
  }

  @media (max-width: 768px) {
    .comparison-table {
      font-size: 0.875rem;
    }
    
    .comparison-table th,
    .comparison-table td {
      padding: 0.5rem;
    }
    
    .comparison-table img {
      width: 48px;
      height: 48px;
    }
  }

  .comparison-table a:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
  }
</style>
